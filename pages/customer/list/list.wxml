<!--pages/customer/list/list.wxml-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
  <view class="search-input-wrapper">
    <view class="search-icon">ğŸ”</view>
    <input class="search-input" placeholder="æœç´¢å®¢æˆ·åç§°ã€è”ç³»äººæˆ–ç”µè¯" confirm-type="search" bindinput="onSearchInput" value="{{searchKeyword}}"/>
  </view>
  <view class="filter-btn" bindtap="showFilterModal">
    <text class="filter-icon">âš™ï¸</text>
  </view>
  <view class="edit-btn" bindtap="toggleEditMode">
    <text class="edit-icon">{{editMode ? 'å®Œæˆ' : 'ç¼–è¾‘'}}</text>
  </view>
</view>

<!-- æ‰¹é‡æ“ä½œæ  -->
<view class="batch-actions" wx:if="{{editMode}}">
  <view class="batch-left">
    <view class="select-all-btn" bindtap="toggleSelectAll">
      <text class="select-all-text">{{selectedCustomers.length === filteredCustomers.length && filteredCustomers.length > 0 ? 'å–æ¶ˆå…¨é€‰' : 'å…¨é€‰'}}</text>
    </view>
    <text class="selected-count">å·²é€‰æ‹© {{selectedCustomers.length}} é¡¹</text>
  </view>
  <view class="batch-right">
    <button class="batch-delete-btn" bindtap="batchDeleteCustomers" disabled="{{selectedCustomers.length === 0}}">
      <text class="btn-text">åˆ é™¤</text>
    </button>
  </view>
</view>

<!-- ç­›é€‰å¼¹çª— -->
<view class="filter-modal" wx:if="{{showFilter}}">
  <view class="filter-panel">
    <view class="filter-header">
      <text class="filter-title">åœ°å€ç­›é€‰</text>
      <text class="close-btn" bindtap="hideFilterModal">Ã—</text>
    </view>
    
    <view class="filter-section">
      <view class="section-title">é€‰æ‹©åœ°åŒº</view>
      <picker mode="region" value="{{region}}" bindchange="bindRegionChange">
        <view class="picker">
          <text wx:if="{{region[0]}}">{{region[0]}} {{region[1]}} {{region[2]}}</text>
          <text wx:else class="placeholder">è¯·é€‰æ‹©åœ°åŒº</text>
        </view>
      </picker>
    </view>
    
    <view class="filter-buttons">
      <button class="btn-reset" bindtap="resetFilters">é‡ç½®</button>
      <button class="btn-confirm" bindtap="applyFilters">ç¡®å®š</button>
    </view>
  </view>
</view>
  
  <!-- å®¢æˆ·åˆ—è¡¨ -->
  <view class="customer-list">
    <block wx:if="{{filteredCustomers.length > 0}}">
      <view class="customer-card {{editMode ? 'edit-mode' : ''}} {{selectedCustomers.indexOf(item.id) > -1 ? 'selected' : ''}}" wx:for="{{filteredCustomers}}" wx:key="id" bindtap="{{editMode ? 'toggleSelectCustomer' : 'viewCustomerDetail'}}" data-id="{{item.id}}">
        <!-- å®¢æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
        <view class="card-header">
          <!-- ç¼–è¾‘æ¨¡å¼ä¸‹çš„é€‰æ‹©æ¡† -->
          <view class="delete-indicator" wx:if="{{editMode && selectedCustomers.indexOf(item.id) > -1}}">
            <text class="delete-icon">ğŸ—‘ï¸</text>
          </view>

          <view class="customer-avatar">
            <text class="avatar-text">{{item.name.charAt(0)}}</text>
          </view>
          <view class="customer-info">
            <view class="customer-name">{{item.name}}</view>
            <view class="customer-contact" wx:if="{{item.contact}}">{{item.contact}}</view>
            <view class="visit-countdown" wx:if="{{item.visitCountdown !== undefined}}">
              <text class="countdown-text">æ‹œè®¿å€’è®¡æ—¶{{item.visitCountdown}}å¤©</text>
            </view>
          </view>
          <view class="card-arrow" wx:if="{{!editMode}}">â€º</view>
        </view>
        
        <!-- è”ç³»æ–¹å¼ -->
        <view class="card-content">
          <view class="info-row" wx:if="{{item.phone}}">
            <view class="info-icon">ğŸ“</view>
            <view class="info-text">{{item.phone}}</view>
            <button class="quick-call-btn" catchtap="callCustomer" data-phone="{{item.phone}}">æ‹¨æ‰“</button>
          </view>
          <view class="info-row" wx:if="{{item.address}}">
            <view class="info-icon">ğŸ“</view>
            <view class="info-text">{{item.address}}</view>
          </view>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="card-actions">
          <button class="action-btn primary-btn" catchtap="visitCustomer" data-id="{{item.id}}">
            <text class="btn-icon">ğŸ“</text>
            <text class="btn-text">æ‹œè®¿</text>
          </button>
          <button class="action-btn secondary-btn" catchtap="viewCustomerDetail" data-id="{{item.id}}">
            <text class="btn-icon">ğŸ‘</text>
            <text class="btn-text">è¯¦æƒ…</text>
          </button>
        </view>
      </view>
    </block>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <view class="empty-title">æš‚æ— å®¢æˆ·</view>
      <view class="empty-desc">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªå®¢æˆ·</view>
      <button class="empty-action-btn" bindtap="addCustomer">ç«‹å³æ·»åŠ </button>
    </view>
  </view>
  
  <!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="addCustomer">
    <text class="fab-icon">+</text>
  </view>
</view>