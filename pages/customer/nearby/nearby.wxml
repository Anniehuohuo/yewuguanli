<!--nearby.wxml-->
<view class="container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-content">
      <view class="title">
        <text class="title-icon">ğŸ“</text>
        <text class="title-text">é™„è¿‘å®¢æˆ·</text>
      </view>
      <view class="location-status">
        <text wx:if="{{locationStatus === 'loading'}}" class="status-text loading">æ­£åœ¨å®šä½...</text>
        <text wx:elif="{{locationStatus === 'success'}}" class="status-text success">å®šä½æˆåŠŸ</text>
        <text wx:else class="status-text failed">å®šä½å¤±è´¥</text>
        <view class="refresh-btn" bindtap="refreshLocation">
          <text class="refresh-icon">ğŸ”„</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-section" wx:if="{{locationStatus === 'success'}}">
    <view class="stats-card">
      <view class="stats-item">
        <text class="stats-number">{{nearbyCustomers.length}}</text>
        <text class="stats-label">é™„è¿‘å®¢æˆ·ï¼ˆ2kmå†…ï¼‰</text>
      </view>
      <view class="stats-action">
        <button class="plan-btn" bindtap="viewVisitPlan">
          <text class="plan-icon">ğŸ“…</text>
          <text>æŸ¥çœ‹æ‹œè®¿è®¡åˆ’</text>
        </button>
      </view>
    </view>
  </view>

  <!-- å®¢æˆ·åˆ—è¡¨ -->
  <view class="customer-section">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{locationStatus === 'loading'}}" class="loading-state">
      <view class="loading-icon">ğŸ“</view>
      <text class="loading-text">æ­£åœ¨è·å–æ‚¨çš„ä½ç½®...</text>
      <text class="loading-desc">è¯·ç¡®ä¿å·²å¼€å¯ä½ç½®æƒé™</text>
    </view>

    <!-- å®šä½å¤±è´¥çŠ¶æ€ -->
    <view wx:elif="{{locationStatus === 'failed'}}" class="error-state">
      <view class="error-icon">âŒ</view>
      <text class="error-text">ä½ç½®è·å–å¤±è´¥</text>
      <text class="error-desc">è¯·æ£€æŸ¥ä½ç½®æƒé™è®¾ç½®</text>
      <button class="retry-btn" bindtap="refreshLocation">é‡æ–°å®šä½</button>
    </view>

    <!-- å®¢æˆ·åˆ—è¡¨ -->
    <view wx:elif="{{nearbyCustomers.length > 0}}" class="customer-list">
      <view class="list-header">
        <text class="list-title">é™„è¿‘å®¢æˆ·åˆ—è¡¨</text>
        <text class="list-count">å…±{{nearbyCustomers.length}}ä¸ªå®¢æˆ·</text>
      </view>
      
      <view class="customer-item" wx:for="{{nearbyCustomers}}" wx:key="id">
        <view class="customer-main" bindtap="viewCustomerDetail" data-index="{{index}}">
          <view class="customer-avatar">
            <text class="avatar-text">{{item.name.charAt(0)}}</text>
          </view>
          <view class="customer-info">
            <view class="customer-name-row">
              <text class="customer-name">{{item.name}}</text>
              <view wx:if="{{item.inPlan}}" class="drop-in-tag">é¡ºè®¿</view>
            </view>
            <text class="customer-contact">{{item.contact}} Â· {{item.phone}}</text>
            <text class="customer-address">{{item.address}}</text>
          </view>
          <view class="customer-distance">
            <text class="distance-text">{{item.distance}}km</text>
            <text class="distance-label">è·ç¦»</text>
          </view>
        </view>
        
        <view class="customer-actions">
          <button 
            class="action-btn {{item.inPlan ? 'disabled' : 'primary'}}" 
            bindtap="addToVisitPlan" 
            data-index="{{index}}"
            disabled="{{item.inPlan || loading}}"
          >
            <text class="btn-icon">{{item.inPlan ? 'âœ“' : '+'}}</text>
            <text class="btn-text">{{item.inPlan ? 'å·²åŠ å…¥' : 'é¡ºè®¿'}}</text>
          </button>
        </view>
      </view>
    </view>

    <!-- æ— å®¢æˆ·çŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ”</view>
      <text class="empty-text">é™„è¿‘2å…¬é‡Œå†…æš‚æ— å®¢æˆ·</text>
      <text class="empty-desc">æ‚¨å¯ä»¥å°è¯•æ‰©å¤§æœç´¢èŒƒå›´æˆ–æ·»åŠ æ–°å®¢æˆ·</text>
      <view class="empty-actions">
        <button class="empty-btn" bindtap="refreshLocation">
          <text class="btn-icon">ğŸ”„</text>
          <text>é‡æ–°æœç´¢</text>
        </button>
      </view>
    </view>
  </view>
</view>