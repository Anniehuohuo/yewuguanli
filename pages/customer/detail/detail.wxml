<!--pages/customer/detail/detail.wxml-->
<view class="container">
  <!-- å®¢æˆ·åŸºæœ¬ä¿¡æ¯ -->
  <view class="card">
    <view class="card-header">
      <text>åŸºæœ¬ä¿¡æ¯</text>
      <view class="header-actions">
        <text class="action-btn" bindtap="editCustomer">ç¼–è¾‘</text>
        <text class="action-btn delete" bindtap="deleteCustomer">åˆ é™¤</text>
      </view>
    </view>
    <view class="card-body">
      <view class="info-item">
        <text class="info-label">å®¢æˆ·åç§°</text>
        <text class="info-value">{{customer.name || 'æ— '}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">è”ç³»äºº</text>
        <text class="info-value">{{customer.contact || 'æ— '}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ç”µè¯</text>
        <view class="info-value with-action">
          <text>{{customer.phone || 'æ— '}}</text>
          <text class="action-text" bindtap="callPhone" wx:if="{{customer.phone}}">æ‹¨æ‰“</text>
        </view>
      </view>
      <view class="info-item">
        <text class="info-label">åœ°å€</text>
        <view class="info-value with-action">
          <text>{{customer.address || 'æ— '}}</text>
          <text class="action-text" bindtap="viewLocation" wx:if="{{customer.latitude && customer.longitude}}">æŸ¥çœ‹</text>
        </view>
      </view>
      <view class="info-item">
        <text class="info-label">å¤‡æ³¨</text>
        <text class="info-value">{{customer.remark || 'æ— '}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">åˆ›å»ºæ—¶é—´</text>
        <text class="info-value">{{customer.createTime || 'æ— '}}</text>
      </view>
    </view>
  </view>
  
  <!-- è®°å½•åˆ‡æ¢å’Œæ˜¾ç¤º -->
  <view class="card">
    <view class="card-header">
      <text>å®¢æˆ·è®°å½•</text>
      <text class="action-btn" bindtap="{{currentTab === 'visit' ? 'addVisit' : 'addCheckin'}}">æ–°å¢</text>
    </view>
    
    <!-- åˆ‡æ¢æ ‡ç­¾ -->
    <view class="tab-container">
      <view class="tab-item {{currentTab === 'visit' ? 'active' : ''}}" bindtap="switchTab" data-tab="visit">
        <text class="tab-text">æ‹œè®¿è®°å½•</text>
        <text class="tab-count">({{visits.length}})</text>
      </view>
      <view class="tab-item {{currentTab === 'checkin' ? 'active' : ''}}" bindtap="switchTab" data-tab="checkin">
        <text class="tab-text">æ‰“å¡è®°å½•</text>
        <text class="tab-count">({{checkins.length}})</text>
      </view>
    </view>
    
    <view class="card-body">
      <!-- æ‹œè®¿è®°å½• -->
      <view wx:if="{{currentTab === 'visit'}}">
        <block wx:if="{{visits.length > 0}}">
          <view class="visit-item" wx:for="{{visits}}" wx:key="id" bindtap="viewVisitDetail" bindlongpress="deleteVisit" data-id="{{item.id}}">
            <view class="visit-time">{{item.visitTime}}</view>
            <view class="visit-content">
              <view class="visit-summary" wx:if="{{item.summary}}">{{item.summary}}</view>
              <view class="visit-photos" wx:if="{{item.photos && item.photos.length > 0}}">
                <image class="visit-photo" wx:for="{{item.photos}}" wx:for-item="photo" wx:key="index" src="{{photo}}" mode="aspectFill" catchtap="previewImage" data-url="{{photo}}" data-urls="{{item.photos}}"></image>
              </view>
            </view>
            <view class="visit-arrow">></view>
          </view>
        </block>
        <view wx:else class="empty-state">
          <view class="empty-state-icon">ğŸ“</view>
          <view class="empty-state-text">æš‚æ— æ‹œè®¿è®°å½•</view>
        </view>
      </view>
      
      <!-- æ‰“å¡è®°å½• -->
      <view wx:if="{{currentTab === 'checkin'}}">
        <block wx:if="{{checkins.length > 0}}">
          <view class="checkin-item" wx:for="{{checkins}}" wx:key="id">
            <view class="checkin-time">{{item.checkinTime}}</view>
            <view class="checkin-content">
              <view class="checkin-address" wx:if="{{item.address}}">ğŸ“ {{item.address}}</view>
              <view class="checkin-remark" wx:if="{{item.remark}}">{{item.remark}}</view>
              <view class="checkin-photos" wx:if="{{item.photos && item.photos.length > 0}}">
                <image class="checkin-photo" wx:for="{{item.photos}}" wx:for-item="photo" wx:key="index" src="{{photo}}" mode="aspectFill" catchtap="previewImage" data-url="{{photo}}" data-urls="{{item.photos}}"></image>
              </view>
            </view>
          </view>
        </block>
        <view wx:else class="empty-state">
          <view class="empty-state-icon">ğŸ“·</view>
          <view class="empty-state-text">æš‚æ— æ‰“å¡è®°å½•</view>
        </view>
      </view>
    </view>
  </view>
  
  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn btn-primary" bindtap="addVisit">æ–°å¢æ‹œè®¿</button>
    <button class="btn btn-default" bindtap="addCheckin">æ‰“å¡æ‹ç…§</button>
  </view>
</view>

<!-- åœ°å›¾å¼¹çª— -->
<view class="map-modal {{showMap ? 'show' : ''}}">
  <view class="map-container">
    <map id="customerMap" longitude="{{customer.longitude}}" latitude="{{customer.latitude}}" scale="16" markers="{{markers}}" show-location></map>
  </view>
  <view class="map-actions">
    <button class="btn btn-default" bindtap="closeMap">å…³é—­</button>
    <button class="btn btn-primary" bindtap="openLocation">å¯¼èˆª</button>
  </view>
</view>