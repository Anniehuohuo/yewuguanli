<!--pages/business/manage/manage.wxml-->
<view class="container">
  <!-- 搜索栏 -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <input class="search-input" placeholder="搜索商家名称、类别或地址" value="{{searchKeyword}}" bindinput="onSearchInput" bindconfirm="performSearch" />
      <view class="search-btn" bindtap="performSearch">
        <text class="search-icon">🔍</text>
      </view>
    </view>
  </view>

  <!-- 添加商家按钮 -->
  <view class="add-button" bindtap="showAddModal">
    <text class="add-icon">+</text>
    <text>添加商家</text>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <!-- 商家列表 -->
  <view wx:else class="business-list">
    <view wx:if="{{businesses.length === 0}}" class="empty-state">
      <text>暂无商家数据</text>
    </view>
    
    <view wx:else>
      <view class="business-item" wx:for="{{businesses}}" wx:key="id">
        <view class="business-info" bindtap="viewBusiness" data-id="{{item.id}}">
          <view class="business-header">
            <text class="business-name">{{item.name}}</text>
            <view class="business-status {{item.status}}">
              <text>{{item.status === 'active' ? '营业中' : '已停业'}}</text>
            </view>
          </view>
          
          <view class="business-details">
            <text class="business-category">{{item.category}}</text>
            <text class="business-rating">评分: {{item.rating}}</text>
          </view>
          
          <view class="business-contact">
            <text class="business-address">{{item.address}}</text>
            <text class="business-phone">{{item.phone}}</text>
          </view>
        </view>
        
        <view class="business-actions">
          <view class="action-btn edit-btn" bindtap="editBusiness" data-id="{{item.id}}">
            <text>编辑</text>
          </view>
          <view class="action-btn status-btn" bindtap="toggleBusinessStatus" data-id="{{item.id}}">
            <text>{{item.status === 'active' ? '停业' : '营业'}}</text>
          </view>
          <view class="action-btn delete-btn" bindtap="deleteBusiness" data-id="{{item.id}}" data-name="{{item.name}}">
            <text>删除</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 添加商家模态框 -->
  <view wx:if="{{showAddModal}}" class="modal-overlay" bindtap="hideAddModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">添加新商家</text>
        <view class="modal-close" bindtap="hideAddModal">
          <text>×</text>
        </view>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <text class="form-label">商家名称 *</text>
          <input class="form-input" placeholder="请输入商家名称" value="{{newBusiness.name}}" bindinput="onNewBusinessInput" data-field="name" />
        </view>
        
        <view class="form-group">
          <text class="form-label">商家类别 *</text>
          <picker class="form-picker" bindchange="onCategoryChange" value="{{newBusiness.category}}" range="{{categories}}">
            <view class="picker-display">
              <text class="{{newBusiness.category ? '' : 'placeholder'}}">{{newBusiness.category || '请选择商家类别'}}</text>
              <text class="picker-arrow">></text>
            </view>
          </picker>
        </view>
        
        <view class="form-group">
          <text class="form-label">联系电话 *</text>
          <input class="form-input" placeholder="请输入联系电话" value="{{newBusiness.phone}}" bindinput="onNewBusinessInput" data-field="phone" />
        </view>
        
        <view class="form-group">
          <text class="form-label">商家地址 *</text>
          <input class="form-input" placeholder="请输入商家地址" value="{{newBusiness.address}}" bindinput="onNewBusinessInput" data-field="address" />
        </view>
        
        <view class="form-group">
          <text class="form-label">商家描述</text>
          <textarea class="form-textarea" placeholder="请输入商家描述" value="{{newBusiness.description}}" bindinput="onNewBusinessInput" data-field="description"></textarea>
        </view>
      </view>
      
      <view class="modal-footer">
        <view class="modal-btn cancel-btn" bindtap="hideAddModal">
          <text>取消</text>
        </view>
        <view class="modal-btn confirm-btn" bindtap="submitNewBusiness">
          <text>确定</text>
        </view>
      </view>
    </view>
  </view>
</view>